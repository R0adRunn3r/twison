window.storyFormat({
  "name": "Twivan",
  "version": "0.0.3",
  "author": "RoadRunner",
  "description": "Export your Twine 2 story as a JSON document with new variable style",
  "proofing": false,
  "source": "<html>\r\n\t<head>\r\n\t\t<title>{{STORY_NAME}}</title>\r\n\t\t<script type=\"text/javascript\">\r\nvar Twison={extractLinksFromText:function(t){var n=t.match(/\\[\\[.+?\\]\\]/g);if(n)return n.map(function(t){var n=t.match(/\\[\\[(.*?)\\-\\&gt;(.*?)\\]\\]/);if(n){var a={link:n[2]},e=n[1].match(/%%([^!]+)%%/),r=n[1].match(/%%!([^!]+)%%/);return e&&(n[1]=n[1].replace(/%%([^!]+)%%/,\"\"),a.set=e[1]),r&&(n[1]=n[1].replace(/%%!([^!]+)%%/,\"\"),a.unset=r[1]),a.name=n[1],a}return t=t.substring(2,t.length-2),{name:t,link:t}})},convertPassage:function(t){var n={text:t.innerHTML},a=Twison.extractLinksFromText(n.text);if(a&&(n.links=a),n.text=n.text.replace(/%%.+%%/g,\"\"),n.text.match(/%IFPASSAGE%/g)&&(n.ifpassage=!0),[\"name\",\"pid\",\"position\",\"tags\"].forEach(function(a){var e=t.attributes[a].value;e&&(n[a]=e)}),n.position){var e=n.position.split(\",\");n.position={x:e[0],y:e[1]}}return n.tags&&(n.tags=n.tags.split(\" \")),n},convertStory:function(t){var n=t.getElementsByTagName(\"tw-passagedata\"),a=Array.prototype.slice.call(n).map(Twison.convertPassage),e={passages:a};[\"name\",\"startnode\",\"creator\",\"creator-version\",\"ifid\"].forEach(function(n){var a=t.attributes[n].value;a&&(e[n]=a)});var r={};return e.passages.forEach(function(t){r[t.name]=t.pid}),e.passages.forEach(function(t){t.links&&t.links.forEach(function(t){t.pid=r[t.link],t.pid||(t.broken=!0)})}),e},convert:function(){var t=document.getElementsByTagName(\"tw-storydata\")[0],n=JSON.stringify(Twison.convertStory(t),null,2);document.getElementById(\"output\").innerHTML=n}};window.Twison=Twison;\t\t\r\n\t\t</script>\r\n\t</head>\r\n\t<body>\r\n\t\t<pre id=\"output\">\r\n\t\t\r\n\t\t</pre>\r\n\t\t<div id=\"storyData\" style=\"display: none;\">\r\n\t\t\t{{STORY_DATA}}\r\n\t\t</div>\r\n\t\t<script>\r\n\t\t\tTwison.convert()\r\n\t\t</script>\r\n\t</body>\r\n</html>"
});